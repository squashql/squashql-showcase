(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[531,231],{9094:function(e,a,t){Promise.resolve().then(t.bind(t,6970))},2061:function(e){"use strict";let a=[],t=[],l=(e,l)=>{let n,r,i,s;if(e===l)return 0;let o=e;e.length>l.length&&(e=l,l=o);let d=e.length,c=l.length;for(;d>0&&e.charCodeAt(~-d)===l.charCodeAt(~-c);)d--,c--;let m=0;for(;m<d&&e.charCodeAt(m)===l.charCodeAt(m);)m++;if(d-=m,c-=m,0===d)return c;let u=0,p=0;for(;u<d;)t[u]=e.charCodeAt(m+u),a[u]=++u;for(;p<c;)for(u=0,n=l.charCodeAt(m+p),i=p++,r=p;u<d;u++)s=n===t[u]?i:i+1,i=a[u],r=a[u]=i>r?s>r?r+1:s:s>i?i+1:s;return r};e.exports=l,e.exports.default=l},2231:function(e,a,t){"use strict";t.d(a,{Z:function(){return r}});var l=t(3827),n=t(5077);function r(e){return(0,l.jsxs)("div",{className:"form-floating",children:[(0,l.jsxs)("select",{className:"form-select",id:"floatingSelect","aria-label":"Floating label select example",onChange:e.onChange,value:void 0===e.value?"DEFAULT":e.value,children:[(0,l.jsxs)("option",{value:"DEFAULT",children:["Select ",e.label]},-1),e.fields.map((e,a)=>(0,l.jsx)("option",{value:(0,n.$$)(e),children:(0,n.$$)(e)},a))]}),(0,l.jsx)("label",{htmlFor:"floatingSelect",children:e.label})]})}t(4090)},6970:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return E}});var l=t(3827),n=t(4194),r=t(8408),i=t(8899),s=t(1857);class o{query(e,a,t,l){return(0,n.from)(this.forecastTable._name).where((0,r.T1)(t)).select(e,[],a).build()}constructor(e,a,t,l){this.forecastTable=e,this.mapping=a,this.year=t,this.month=l,this.selectableFields=this.forecastTable._fields;let r=function(e,a,t){if(!e||!e.pnl||!e.type||!e.accrual||!e.year||!e.month)return{measures:[n.countRows],formatters:[]};{let l;l=t?(0,n.any)([(0,n.all)([(0,n.criterion)(e.year,(0,n.eq)(a)),(0,n.criterion)(e.month,(0,n.le)(t)),(0,n.criterion)(e.type,(0,n.eq)("actual"))]),(0,n.all)([(0,n.criterion)(e.year,(0,n.lt)(a)),(0,n.criterion)(e.type,(0,n.eq)("actual"))]),(0,n.all)([(0,n.criterion)(e.year,(0,n.eq)(a)),(0,n.criterion)(e.month,(0,n.gt)(t)),(0,n.criterion)(e.type,(0,n.eq)("model"))]),(0,n.all)([(0,n.criterion)(e.year,(0,n.gt)(a)),(0,n.criterion)(e.type,(0,n.eq)("model"))])]):(0,n.any)([(0,n.all)([(0,n.criterion)(e.year,(0,n.le)(a)),(0,n.criterion)(e.type,(0,n.eq)("actual"))]),(0,n.all)([(0,n.criterion)(e.year,(0,n.gt)(a)),(0,n.criterion)(e.type,(0,n.eq)("model"))])]);let r=(0,n.all)([(0,n.criterion)(e.pnl,(0,n.eq)("Revenue")),l]),o=(0,n.all)([(0,n.criterion)(e.pnl,(0,n.eq)("Revenue")),(0,n.criterion)(e.type,(0,n.eq)("model"))]),d=(0,n.all)([(0,n.criterion)(e.pnl,(0,n.neq)("Revenue")),l]),c=(0,n.all)([(0,n.criterion)(e.pnl,(0,n.neq)("Revenue")),(0,n.criterion)(e.type,(0,n.eq)("model"))]),m=(0,n.sumIf)("Rev Actl/Fcst",e.accrual,r),u=(0,n.sumIf)("Rev Fcst",e.accrual,o),p=(0,n.sumIf)("Exp Actl/Fcst",e.accrual,d),f=(0,n.sumIf)("Exp Fcst",e.accrual,c),h=(0,n.sumIf)("Pnl Act/Fcst",e.accrual,l),b=(0,n.sumIf)("Pnl Fcst",e.accrual,(0,n.criterion)(e.type,(0,n.eq)("model"))),g=(0,n.divide)("Margin Act/Fcst",h,m),v=(0,n.divide)("Margin Fcst",b,u),y=[m,u,p,f,h,b,g,v],x=[],j=[];for(let a of y){let t="YoY % ".concat(a.alias," Growth");x.push((0,n.comparisonMeasureWithPeriod)(t,n.ComparisonMethod.RELATIVE_DIFFERENCE,a,new Map([[e.year,"y-1"]]),new n.Year(e.year))),j.push(new i.c9(t,s.yE))}let N=[new i.c9(g.alias,s.yE),new i.c9(v.alias,s.yE)].concat(j);return{measures:y.concat(n.countRows).concat(x),formatters:N}}}(this.mapping,this.year,this.month);this.measures=r.measures,this.formatters=r.formatters,this.table=[this.forecastTable]}}var d=t(5151),c=t(4232),m=t(4090),u=t(2231);let p=[],f=new Date().getFullYear();for(let e=f;e>=f-5;e--)p.push(e);let h=Array.from({length:12},(e,a)=>a+1);function b(e){var a,t;let[n,r]=(0,m.useState)({});return(0,l.jsx)("div",{className:"modal fade",id:"forecastperiodselectorModal",tabIndex:-1,"aria-labelledby":"forecastperiodselectorModalLabel","aria-hidden":"true",children:(0,l.jsx)("div",{className:"modal-dialog",children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h1",{className:"modal-title fs-5",id:"forecastperiodselectorModalLabel",children:'Select the end period of "Actual" (inclusive)'}),(0,l.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),(0,l.jsxs)("div",{className:"modal-body",children:[(0,l.jsx)("div",{className:"pb-1",children:(0,l.jsx)(u.Z,{label:"year",value:null===(a=n.year)||void 0===a?void 0:a.toString(),fields:p.map(e=>e.toString()),onChange:e=>{let a=Number(e.target.value);r(e=>({...e,year:a}))}})}),(0,l.jsx)("div",{className:"pb-1",children:(0,l.jsx)(u.Z,{label:"month",value:null===(t=n.month)||void 0===t?void 0:t.toString(),fields:h.map(e=>e.toString()),onChange:e=>{let a=Number(e.target.value);r(e=>({...e,month:a}))}})})]}),(0,l.jsxs)("div",{className:"modal-footer",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),(0,l.jsx)("button",{type:"button",className:"btn btn-primary","data-bs-dismiss":"modal",disabled:!(void 0!==n.year),onClick:function(){void 0!==n.year&&e.onForecastPeriodSelected(n.year,n.month)},children:"Save"})]})]})})})}var g=t(5077),v=t(2061),y=t.n(v);let x=["year","month","type","pnl","accrual"];function j(e){let a=void 0!==e.currentMapping?e.currentMapping:function(e){let a={};for(let t of x){let l;let n=e.fields.map(e=>e.fieldName.toLowerCase());for(let[e,a]of n.entries())if(a.includes(t)){l=e;break}if(!l){let[e,a]=[Number.MAX_SAFE_INTEGER,-1];for(let[l,r]of n.entries()){let n=y()(t,r);n<e&&(e=n,a=l)}l=a}a[t]=e.fields[l]}return a}(e),[t,n]=(0,m.useState)(a);return(0,l.jsx)("div",{className:"modal fade",id:"mappingconfiguratorModal",tabIndex:-1,"aria-labelledby":"mappingconfiguratorModalLabel","aria-hidden":"true",children:(0,l.jsx)("div",{className:"modal-dialog",children:(0,l.jsxs)("div",{className:"modal-content",children:[(0,l.jsxs)("div",{className:"modal-header",children:[(0,l.jsx)("h1",{className:"modal-title fs-5",id:"mappingconfiguratorModalLabel",children:"Define column mapping"}),(0,l.jsx)("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),(0,l.jsx)("div",{className:"modal-body",children:x.map(a=>{var r;return(0,l.jsx)("div",{className:"pb-1",children:(0,l.jsx)(u.Z,{label:a,value:(0,g.$$)(null!==(r=t[a])&&void 0!==r?r:""),fields:e.fields,onChange:t=>(function(a,t){let l=e.fields.map(e=>(0,g.$$)(e)).indexOf(a.target.value);n(a=>{let n={...a};return n[t]=e.fields[l],n})})(t,a)},a)},a)})}),(0,l.jsxs)("div",{className:"modal-footer",children:[(0,l.jsx)("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),(0,l.jsx)("button",{type:"button",className:"btn btn-primary","data-bs-dismiss":"modal",disabled:!x.every(e=>void 0!==t[e]),onClick:function(){t.accrual&&t.type&&t.year&&t.month&&t.pnl&&e.onSave({accrual:t.accrual,year:t.year,month:t.month,type:t.type,pnl:t.pnl})},children:"Save"})]})]})})})}let N=(0,c.default)(()=>t.e(891).then(t.bind(t,2891)),{loadableGenerated:{webpack:()=>[2891]},ssr:!1}),w="dashboard#state#fpna",F="page#state#fpna",C="forecast",S=new Date().getFullYear()-1;function E(){var e;let[a,t]=(0,m.useState)(!1),[s,c]=(0,m.useState)(function(e){{let a=window.localStorage.getItem(e);if(a)return(0,i.iG)(a)}return{year:S,version:0}}(F));function u(e){r.c_.querier.getMetadata().then(a=>{let t=a.stores.find(e=>e.name===C);if(void 0!==t){let a=t.fields.map(e=>new n.TableField("".concat(C,".").concat(e.name)));c(l=>({...l,table:{_name:t.name,_fields:a},mapping:e?void 0:l.mapping,version:l.version+1}))}})}if((0,m.useEffect)(()=>{t(!0)},[]),(0,m.useEffect)(()=>{window.localStorage.setItem(F,JSON.stringify(s))},[s]),(0,m.useEffect)(()=>{u(!1)},[null===(e=s.table)||void 0===e?void 0:e._fields.map(e=>(0,g.$$)(e)).join()]),s.table){let e=new o(s.table,s.mapping,s.year,s.month);return a&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(N,{title:"Financial planning and analysis",queryProvider:e,storageKey:w,menuElements:[(0,l.jsx)(M,{year:s.year,month:s.month,isMappingDefined:void 0!==s.mapping},"settings")],elements:[(0,l.jsx)(d.Z,{table:C,onFileUploaded:function(){(0,i.np)(w),u(!0)}},"uf")]},"d"+s.version),(0,l.jsx)(b,{onForecastPeriodSelected:function(e,a){(0,i.np)(w),c(t=>({...t,year:e,month:a,version:t.version+1}))}}),(0,l.jsx)(j,{fields:s.table._fields,currentMapping:s.mapping,onSave:function(e){(0,i.np)(w),c(a=>({...a,mapping:e,version:a.version+1}))}},"mc"+s.version)]})}}function M(e){let a;let t=(a=0,!e.isMappingDefined&&a++,void 0===e.year&&a++,a);return(0,l.jsx)("div",{className:"col px-0 mx-1 my-1",children:(0,l.jsxs)("div",{className:"dropdown",children:[(0,l.jsxs)("button",{className:"btn btn-light btn-sm dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",children:["Settings",t>0&&(0,l.jsxs)(l.Fragment,{children:["\xa0",(0,l.jsx)("span",{className:"badge text-bg-danger rounded-pill",children:t})]})]}),(0,l.jsxs)("ul",{className:"dropdown-menu",children:[(0,l.jsx)("li",{children:(0,l.jsxs)("a",{className:"dropdown-item",href:"#","data-bs-toggle":"modal","data-bs-target":"#forecastperiodselectorModal",children:["Actual end period (year=",e.year,e.month&&", month=".concat(e.month),")"]})}),(0,l.jsx)("li",{children:(0,l.jsxs)("a",{className:"dropdown-item",href:"#","data-bs-toggle":"modal","data-bs-target":"#mappingconfiguratorModal",children:["Configure column mapping",!e.isMappingDefined&&(0,l.jsxs)(l.Fragment,{children:["\xa0",(0,l.jsx)("span",{className:"badge text-bg-danger rounded-pill",children:"1"})]})]})}),(0,l.jsx)("li",{children:(0,l.jsx)("hr",{className:"dropdown-divider"})}),(0,l.jsx)("li",{children:(0,l.jsx)("a",{className:"dropdown-item",href:"#",onClick:()=>(0,i.np)(F),children:"Clear settings"})})]})]})})}}},function(e){e.O(0,[798,908,716,971,69,744],function(){return e(e.s=9094)}),_N_E=e.O()}]);